document.addEventListener('DOMContentLoaded',()=>{const e=document.getElementById('urlInput'),t=document.getElementById('fetchHtmlBtn'),n=document.getElementById('htmlOutput'),o=document.getElementById('copyCodeBtn'),r=document.getElementById('downloadHtmlBtn');let i,c=0;const l=e=>{o.disabled=!e,r.disabled=!e};t.addEventListener('click',async()=>{const o=e.value.trim();if(!o)return void(n.textContent='Please enter a URL.');if(Date.now()-c<5e3)return;t.disabled=!0,l(!1),c=Date.now(),i&&clearInterval(i),i=setInterval(()=>{const e=Math.ceil((5e3-(Date.now()-c))/1e3);e>0?t.textContent=`Wait ${e}s`:(clearInterval(i),t.textContent='Fetch HTML',t.disabled=!1,n.textContent&&!n.textContent.startsWith('Error')&&!n.textContent.startsWith('Fetch')&&!n.textContent.startsWith('Paste')&&l(!0))},100),await(async e=>{try{n.textContent='Fetching HTML... Please wait.',l(!1),e.startsWith('http')||(e='https://'+e);const t=await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const o=await t.text();if(!o)throw new Error('Retrieved content is empty.');return n.textContent=o,l(!0),o}catch(e){return n.textContent=`Error: ${e.message}\n\nNote: Some websites block automated access or proxies.`,l(!1),console.error('Fetch error:',e),null}})(o)}),o.addEventListener('click',async()=>{const e=n.textContent;if(e)try{await navigator.clipboard.writeText(e);const t=o.textContent;o.textContent='Copied!',setTimeout(()=>o.textContent=t,2e3)}catch(e){console.error('Copy failed:',e),alert('Failed to copy to clipboard.')}}),r.addEventListener('click',()=>{const e=n.textContent;if(e){const t=new Blob([e],{type:'text/html'}),o=URL.createObjectURL(t),r=document.createElement('a');r.href=o,r.download='downloaded_site.html',document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}}),l(!1)});
